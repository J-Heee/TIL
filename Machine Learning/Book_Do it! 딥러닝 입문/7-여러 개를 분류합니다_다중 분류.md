# Chapter 7. 여러 개를 분류합니다 - 다중 분류

## 2021.02.21

### 7-1. 여러 개의 이미지를 분류하는 다층 신경망 만들기

#### 다중 분류 신경망
- **이진 분류**를 위한 다층 신경망 : 마지막 **출력층에 뉴런 한 개**
  - 양성 클래스에 대한 확률값 하나만 출력
- **다중 분류**를 위한 다층 신경망 : 마지막 **출력층에 뉴런 여러 개**
  - **각 클래스에 대한 확률값 출력**
  - **출력층에 분류할 클래스 개수만큼 뉴런 배치**
- 두 신경망을 비교해보면 **출력층의 개수만 다름** (책 p.197-198 구조 참고)

<br>

#### 다중 분류의 문제점과 소프트맥스 함수
- 다중 분류에서 활성화 출력의 합이 1이 아니면 비교가 어렵다는 문제점 존재
- **소프트맥스 함수(softmax function) : 출력층의 출력 강도를 정규화**
  - 출력 강도를 정규화한다는 것은, **전체 출력값의 합을 1로 만들어 값들을 확률로 생각한다는 의미**
  - 소프트맥스 함수의 정의는 책 p.199-200 참고
    - 출력층에서 계산된 선형 출력이 필요하므로 시그모이드 함수 공식을 이용하여 값을 구함
    - 해당 값을 소프트맥스 함수에 대입하면 정규화된 값을 얻을 수 있음
- 다중 분류에서 출력층을 통과한 값들은 소프트맥스 함수를 거치며 적절한 확률값으로 변함 (비교가 편리해짐)
- 이 확률값을 이용하여 가중치와 절편을 업데이트하기 위한 손실 함수 필요

<br>

#### 크로스 엔트로피(cross entropy) 손실 함수 도입
- 다중 분류에는 **로지스틱 손실 함수의 '일반화 버전'** 인 크로스 엔트로피 손실 함수를 사용
  - 로지스틱 손실 함수는 크로스 엔트로피 손실 함수의 이진 분류 버전이었음
- 로지스틱 손실 함수
  - ![로지스틱 손실 함수](https://latex.codecogs.com/svg.latex?L%20%3D%20-%28ylog%28a%29%20&plus;%20%281-y%29log%281-a%29%29)
- **크로스 엔트로피 손실 함수**
  - ![크로스 엔트로피 손실 함수](https://latex.codecogs.com/svg.latex?L%20%3D%20-%5Csum_%7Bc%3D1%7D%5E%7Bc%7Dy_clog%28a_c%29%20%3D%20-%28y_1log%28a_1%29%20&plus;%20y_2log%28a_2%29%20&plus;%20%5Ccdots%20&plus;%20y_clog%28a_c%29%29%20%3D%20-log%28a_%7By%3D1%7D%29)
    - 시그마 기호 위의 값(c) : 전체 클래스 개수 의미
    - 시그마를 풀어 쓴 가운데 수식 : 클래스마다 타깃과 활성화 출력의 로그값을 곱하여 더한 것
    - **분류 문제에서 정답 클래스의 타깃은 1, 나머지 클래스의 타깃은 0**
    - 따라서 정답 클래스를 제외한 나머지 클래스(y=0)에 대한 손실 항은 모두 소거되어 하나의 항만 남음
    - 최종적으로 남은 a는 정답 클래스에 해당하는 활성화 출력 의미
- **로지스틱 손실 함수와 크로스 엔트로피 손실 함수는 매우 비슷함**
  - 로지스틱 손실 함수의 y=1인 경우(양성 클래스) : ![](https://latex.codecogs.com/svg.latex?-log%28a%29)
  - 로지스틱 손실 함수의 y=0인 경우(음성 클래스) : ![](https://latex.codecogs.com/svg.latex?-log%281-a%29)
  - (1-a)를 음성 클래스의 활성화 출력이라 생각하면, 크로스 엔트로피 손실 함수를 정리한 식과 같음
  - **로지스틱 손실 함수는 크로스 엔트로피 손실 함수의 합(시그마) 기호를 빼고, 양성 클래스와 음성 클래스에 대해 나누어 놓은 것**

<br>

#### 크로스 엔트로피 손실 함수의 미분
- 경사하강법을 사용하기 위해 크로스 엔트로피 손실 함수를 미분
  - (미분 공식 유도 과정은 책 p.202-205 참고)
- **크로스 엔트로피 손실 함수의 미분 결과**를 벡터 z에 대하여 정리
  - ![크로스 엔트로피 손실 함수 미분 결과](https://latex.codecogs.com/svg.latex?%7B%5Cpartial%20L%20%5Cover%20%5Cpartial%20z%7D%20%3D%20-%28y%20-%20a%29)
  - **로지스틱 손실 함수의 미분 결과와 정확히 일치**
  - -> 크로스 엔트로피 손실 함수를 역전파에 사용하기 위해 따로 코드를 구현할 필요 없음
  - -> 04장에서 구현한 **`backward()` 메서드 그대로 사용**

<br>