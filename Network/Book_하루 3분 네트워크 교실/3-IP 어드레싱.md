# Chapter 03. IP 어드레싱

## 2021.03.31 - 04.04, 04.07

### 3-1. 3계층의 역할과 개요
- **3계층** : 세그먼트 내에서가 아니라, 세그먼트 간의 데이터 송수신을 하는 것
  - 1계층과 2계층에서 사용하는 세그먼트라는 말 대신, 3계층에서는 이러한 범위를 네트워크라고 함
- **좁은 의미의 '네트워크'** : 3계층에서 사용하는 네트워크는 라우터와 라우터로 나뉘어진 **'컴퓨터 그룹'** 을 말함 (세그먼트와 동의어)
  - 세그먼트와 같으므로, 네트워크 내의 컴퓨터끼리는 2계층에 의해 연결되어 있음
  - 2계층까지의 기능만으로는 컴퓨터의 수가 많은 큰 네트워크 구성이 불가능
- **네트워크를 나누는 이유** : 브로드캐스트가 도달하는 범위를 한정해서 브로드캐스트 문제를 해결
  - 스위치로 구성된 네트워크에서는 1대가 송신한 브로드캐스트가 모든 컴퓨터에 도달
    - 컴퓨터 수가 많으면 브로드캐스트의 횟수가 증가해서, 각 컴퓨터가 브로드캐스트를 처리하는 횟수가 증가  
  - 라우터는 브로드캐스트를 중계하지 않기 때문에, 라우터를 넘어서는 브로드캐스트는 전송되지 않음 
    - 전체 대수가 많아져도 각각의 네트워크에만 브로드캐스트가 도달하기 때문에, 각 컴퓨터가 처리하는 브로드캐스트의 양은 적어질 수 있음 
- **인터넷 작업(Internetwork)** : 네트워크 간에서의 데이터 송수신을 하는 것, 간단히 인터넷(Internet)이라고도 함
  - 고유명사 '인터넷'과 다른 것(INTERNET, The internet, The Net) 
- 3계층에서는 인터넷 작업을 수행
  - 인터넷 작업에 의해 떨어진 위치에 있는 컴퓨터끼리 데이터 통신 가능
  - 2계층까지의 기능은 그 네트워크 내의 인접기기에 대한 데이터 통신
  - 3계층에서는 위치가 떨어져 있는 다른 네트워크 내의 기기와 데이터 통신

<br>
<br>

### 3-2. 인터넷 프로토콜
- **어드레싱**
  - 2계층 이더넷에서 사용되는 MAC 주소는 **'물리 주소'**
    - 위치정보가 없어서 장소를 특정할 수 없는 주소
  - 3계층에서 사용하는 주소는 **'논리 주소'**
    - 논리 주소 : 위치정보를 가지기 때문에 수신처를 찾을 수 있음
    - 위치정보 : '어디 네트워크'의 '어느 컴퓨터'라는 정보의 조합으로 실현
- **라우팅(routing)** : 수신처까지의 경로 선택을 하는 것
  - 수신처에 연결되어 있는 회선(라우터와 라우터를 연결하는 회선이므로 네트워크)에 데이터를 보내도록 지정
  - 라우팅을 행하는 기기가 라우터
- **IP(Internet Protocol)** : '어드레싱'과 '라우팅'에 의해 인터넷 작업을 수행하기 위한 프로토콜로서 TCP/IP 프로토콜군에서 사용되는 것
  - **TCP/IP에서는 IP를 반드시 사용**
- IP는 현재 두 가지 버전이 사용됨
  - IP버전4(IP version4, 줄여서 IPv4), IP버전6(IP version6, 줄여서 IPv6)
  - 현재 일반적으로 사용되고 있는 것은 구 버전인 IPv4
  - 이 두 버전 사이에는 호환성이 없음 (IPv4만 사용하는 컴퓨터는 IPv6를 사용하는 컴퓨터와 데이터 송수신 불가능)
- IP는 인터넷 작업을 수행(어드레싱, 라우팅)하기 위한 기능을 가지고 있음
- **IP 데이터그램(Datagram)** : IP 헤더와 3계층 PDU (데이터에 IP 헤더가 붙은 상태의 PDU)
  - IP 헤더 : 송신처와 수신처의 IP 주소, 라우팅에서 사용하는 값 등이 있음
  - IP 주소 : IP라는 프로토콜에서 정해진 '논리 주소', IP에서는 이 주소를 사용해 수신처와 송신처를 정함

<br>
<br>

### 3-3. IP 주소 1
- IP 주소는 논리 주소이며, 논리 주소의 특징은 **'계층형'**
  - '어디에 있는', '어느 컴퓨터'라는 정보를 'A에 있다', 'A의 안에 있는 B에 있다', 'C라는 컴퓨터'와 같이 세분화한 것이 계층형 주소
  - MAC 주소와 같이 계층형이 아닌 주소는 평면형이라고 부름
- IP 주소는 네트워크 관리자가 컴퓨터에 할당 
  - 네트워크의 접속점마다 관리자가 결정한 주소를 붙이는 것
  - 논리 주소는 물리 주소(ex. MAC 주소)와는 다르게 네트워크에 접속할 때마다 붙이는 것 (인터페이스가 어느 것이든 상관없음)
- 물리 주소와의 차이점
  - MAC 주소는 사용하는 쪽에서 변경 불가능, 인터페이스에 고정된 주소
  - 논리 주소는 인터페이스가 고장나서 다른 인터페이스로 교환하더라도 변경되지 않음 (물리 주소는 변경)
  - 논리 주소는 '어디에 있는', '어느 컴퓨터'라는 의미이므로, 소속된 네트워크가 바뀐 경우(컴퓨터가 있는 장소가 바뀐 경우) 바뀌게 되는 것
- 논리 주소에도 유니캐스트, 멀티캐스트, 브로드캐스트의 3종류 주소 존재
- IP 주소는 **'네트워크 번호'와 '컴퓨터 번호'의 조합으로 유일**해야 함
  - 네트워크 번호 : 접속되어 있는 모든 네트워크에서 유일
  - 컴퓨터 번호 : 소속된 네트워크 내에서 유일 
- **IP 주소는 32비트** (IPv4)
  - MAC 주소는 16진수 12자리, 48비트
  - IPv6에서는 128비트지만, 여기서는 IPv4를 설명하므로 32비트라고 생각
- **옥텟(Octet)** : 8비트의 단락
  1. 8비트를 1옥텟으로 하여 4개의 옥텟으로 분할 (ex. 11000000 10101000 00101010 00000001)
  2. 각 옥텟을 10진수로 표기 (ex. 192 168 42 1)
  3. 옥텟 단락 사이에 점을 찍음 (ex. 192.168.42.1)
     - 왼쪽부터 제1옥텟, 제2옥텟, 제3옥텟, 제4옥텟이라고 부름

<br>
<br>

### 3-4. IP 주소 2
- 인터넷에서는 ICANN이 IP 주소를 실제로 사용하는 인터넷 사업자나 기업 등의 조직에 할당
  - **ICANN**(The Internet Corporation for Assigned Names and Number) : 인터넷에서의 IP 주소를 유일하게 관리하기 위한 단체
- **클래스** : IP 주소는 조직의 규모에 따라 할당되는 범위가 정해져 있으며, 그것을 클래스라고 함
  - 클래스는 A-E의 5개로 나뉨 (해당 범위의 주소를 할당)
  - 클래스에 따라 네트워크 번호를 표시하는 부분의 비트수가 정해져 있음
    - 클래스A - 최초의 8비트가 네트워크 번호, 나머지가 컴퓨터 번호
    - 클래스B - 16비트가 네트워크 번호, 16비트가 컴퓨터 번호
    - 클래스C - 24비트가 네트워크 번호, 8비트가 컴퓨터 번호
    - 클래스D와 E는 특별한 주소라 보통 할당하지 않음
  - 최초 옥텟의 맨앞 몇 비트로 클래스를 식별
    - ex) IP 주소 32비트의 1비트와 2비트가 '1', '0'이면 클래스B 
- 클래스에 의해 컴퓨터 번호의 비트수가 정해지고, 이것으로 조직이 가질 수 있는 IP 주소의 수량이 결정
  - 컴퓨터 번호 부분의 비트수가 많으면, 그만큼 많은 컴퓨터를 소유하는 네트워크가 될 수 있는 것
  - 큰 규모의 네트워크에 A를, 작은 규모에는 C를 할당
  - |클래스|규모|네트워크의 수|1개의 네트워크가 가진 IP 주소의 수|
    |:---:|:----:|:----------:|:------------------------------:|
    | A |정부/연구기관/대기업|128개|16,777,216개|
    | B |대-중규모 기업|16,384개|65,536개|
    | C |중-소규모 기업 프로바이더|2,097,152개|256개|
    | D |멀티캐스트용|||
    | E |연구용|||
- **클래스풀 어드레싱(Classfull Addressing)** : 클래스로 나누어 IP 주소를 할당하는 방식
- **호스트 번호** : 컴퓨터 번호를 호스트 번호라고 함
  - ICANN은 네트워크 번호까지만 할당
  - 호스트 번호는 그 네트워크의 관리자가 마음대로 정하는 것
  - 호스트(Host) : 컴퓨터 등 통신의 주체가 되는 기기
- 호스트 번호 중에는 특별한 의미를 가지므로 실제 컴퓨터에 할당해서는 안되는 주소 존재
  - 호스트 번호의 비트가 모두 0인 주소 - 네트워크 주소 (해당 네트워크 자체를 표시하는 주소)
    - ex) 클래스C의 네트워크 번호가 192.168.10인 경우, 192.168.10.0
  - 호스트 번호의 비트가 모두 1인 주소 - 브로드캐스트 주소 (전체가 수신하는 주소)
    - ex) 클래스C의 네트워크 번호가 192.168.10인 경우, 192.168.10.255

<br>
<br>

### 3-5. 서브네팅
- **서브네트워크(Subnetwork)** 또는 **서브넷(Subnet)** : 분할된 작은 네트워크
  - IP 주소는 계층형이므로 큰 네트워크를 여러 개의 작은 서브네트워크로 분할해서 관리
  - 분할할 경우 **서브넷 번호**(서브네트워크를 나타내는 번호) 필요
  - 호스트 번호의 비트를 서브넷 번호와 호스트 번호로 분할하여 사용
    - IP 주소는 32비트로 고정되어 있어, 새롭게 서브넷 번호 추가가 불가능하기 때문
    - 서브넷 번호로 몇 비트를 사용할지는 네트워크 관리자가 자유롭게 결정 가능
    - ex) 클래스B 네트워크의 172.16.0.0의 경우, 호스트 번호 16비트를 서브넷 번호 6비트와 호스트 번호 10비트로 분할해서 사용
- **서브네팅(Subnetting)** : 서브넷화 하는 것
  - 서브넷은 해당 네트워크 내부에서만 유효 
    - 네트워크 외부에서 보면 네트워크A의 서브넷1이나 서브넷2나 같은 네트워크A에 있기 때문에 몰라도 됨
  - 서브넷 부분의 비트 수에 의해, 서브넷의 수와 서브넷마다 사용할 수 있는 IP 주소의 수가 결정
    - 서브넷의 숫자를 크게 하면 각 서브넷의 호스트 수는 감소함
    - ex) 192.168.100.0 클래스C 네트워크의 경우
      |제1옥텟|제2옥텟|제3옥텟|제4옥텟_서브넷부분|제4옥텟_호스트부분|서브넷의 최대 수|서브넷마다 호스트 수|
      |:-:|:-:|:-:|:-:|:-:|:-:|:-:|
      |11000000|10101000|01100100|-|00000000|없음|254대*|
      ||||0|0000000|2개|126대|
      ||||00|000000|4개|62대|
      ||||000|00000|8개|30대|
      ||||0000|0000|16개|14대|
      ||||00000|000|32개|6대|
      ||||000000|00|64개|2대|
      ||||0000000|0|128개|0대|
      ||||00000000|-|256개|0대|
      - 254대* - 2의 8승은 256, 여기서 네트워크 주소와 브로드캐스트 주소를 제외하기 때문에 254대
- **서브넷마스크(Subnetmask)** : IP 주소 중에 어디까지가 서브넷 번호인지 나타냄 (네트워크 번호와 서브넷 번호의 비트수를 나타내기 위해 사용)
  - IP 주소와 같은 32비트, 네트워크 번호와 서브넷 번호의 비트를 모두 1, 호스트 번호를 0으로 표시
  - 서브넷마스크와 IP 주소의 같은 위치의 비트를 비교해서 보면, 서브넷마스크의 비트가 1인 부분까지가 네트워크 주소
  - IP 주소와 서브넷마스크는 반드시 세트로 기술

<br>
<br>

### 3-6. 클래스리스 어드레싱
- 지금은 클래스로 IP 주소를 할당하는 클래스풀 어드레싱은 사용되지 않음
  - Classfull Addressing은 크기를 A/B/C 3개로만 대략적으로 구분하므로, 그 구분에 딱 맞지 않으면 낭비가 많음
  - 낭비가 많다는 것은, 사용되지 않는 IP 주소가 증가한다는 것 의미
  - ex) 1000개의 IP 주소가 필요한 네트워크의 경우, 클래스C 네트워크(256개의 IP주소)는 부족하고, 클래스B 네트워크(65,536개의 IP주소)는 충분하지만 사용되지 않는 주소가 많음
- **클래스리스 어드레싱(Classless Addressing)** : 클래스라는 구분을 사용하지 않는 할당 방식
  - 필요한 IP 주소의 개수로부터 네트워크 번호를 결정하는 방식
  - 필요에 따른 비트 수로 정함
  - ex) 약 16,000개의 IP 주소가 필요하다면, 호스트 부분을 14비트, 네트워크 부분을 32 - 14 = 18비트로 결정
- **슈퍼넷(Super Network)** : 클래스를 통합해서 1개로 하는 것
  - ex) 클래스C의 네트워크를 통합해서 1개의 네트워크로 운용하는 경우 - 2,000개의 주소가 필요한 네트워크
    - 클래스C에서는 주소가 부족하고, 클래스B에서는 주소가 너무 많음
    - 192.168.32.0-192.168.39.0의 8개의 클래스C 네트워크를 통합해서 2,048개의 IP 주소를 가지는 네트워크로 생성 (256개 X 8 = 2,048개)  
- 현재는 낭비가 없고 편리한 클래스리스 어드레싱이 주로 사용되고 있음
- 클래스리스 어드레싱의 **문제점**
  - 클래스가 없기 때문에 어디까지가 네트워크 번호의 비트인지를 모름
  - 어디까지가 네트워크 번호인지를 나타내는 값을 부여해야 함
  - 서브넷마스크는 클래스풀 네트워크의 서브네팅에서 사용하는 것으로, 클래스리스 어드레싱에서 사용하는 것은 아님
- **프리픽스 길이(Prefix-Length)** : 네트워크 번호의 길이(비트 수)를 나타내는 값
  - IP 주소 뒤에 슬래시를 넣고, 그 뒤에 프리픽스 길이를 작성
  - 프리픽스 길이가 있으면 네트워크 번호의 비트 수를 알 수 있는 구조 (서브넷마스크와 거의 비슷한 역할)
  - 실제로는 서브넷마스크를 대신 사용하거나, 서브넷마스크 대신에 프리픽스 길이를 사용하기도 함
  - ex) 21비트를 네트워크 번호, 11비트를 호스트 번호로 하는 경우
    ||제1옥텟|제2옥텟|제3옥텟|제4옥텟|
    |-|:-:|:-:|:-:|:-:|
    |192.168.32.0|1100 0000|1010 0000|0010 0000|0000 0000|
    - 192.168.32.0/21 (-> /21 부분이 프리픽스 길이)
    - 서브넷마스크의 255.255.248.0과 거의 같은 의미
      |255|255|248|0|
      |:-:|:-:|:-:|:-:|
      |1111 1111|1111 1111|1111 1000|0000 0000|

<br>
<br>

### Reference
- [하루 3분 네트워크 교실](http://www.yes24.com/Product/Goods/30670329) - 아미노 에이지 저. 영진닷컴. 2016