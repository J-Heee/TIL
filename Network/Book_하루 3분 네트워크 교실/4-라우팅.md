# Chapter 04. 라우팅

## 2021.04.13, 04.18 - 04.21

### 4-1. 주소와 경로
- IP 주소는 데이터의 '최종 수신처', MAC 주소는 '다음 수신처'를 결정
  - 데이터가 복수의 네트워크를 경유해서 최종 수신 컴퓨터에 도달할 경우, 다음에 보낼 장소를 결정하는 MAC 주소는 계속 변경됨 
- **홉 바이 홉(Hop-by-Hop) 방식** : 라우터는 다음 수신처를 결정하고, 이러한 반복이 연결되어 경로가 되는 것
  - 라우터라는 장치가 수신처까지의 경로를 결정하는 역할
  - 실제로 라우터는 자신의 위치에서 수신처까지 가기 위해 다음에 어디로 보내야 할지 그것만 결정, 송신처에서 수신처까지의 모든 길을 이해하고 있는 것은 아님
  - 라우팅에서 홉이란, 라우터를 가리키는 용어
  - 복수의 라우터가 다음 수신처를 가리키는 과정을 반복함으로써, 전체의 '경로'가 만들어지는 것
  - 라우터가 네트워크 경계상에 배치되어서 전송받은 데이터그램을 라우팅해서 다음 수신처를 결정
- **디폴트 게이트웨이(Default Gateway)** : 컴퓨터에 설정되어 있는 라우터
- **라우터가 없으면 다른 네트워크에 데이터그램을 보낼 수 없음**
  - 컴퓨터가 송신하는 규칙
  - 동일 네트워크에 수신처가 있는 경우, 수신처에 직접 송신 
  - 다른 네트워크에 수신처가 있는 경우, 라우터로 송신
    - 라우터(디폴트 게이트웨이)가 설정되어 있지 않은 경우는, 다른 네트워크에 송신 불가능

<br>
<br>

### 4-2. 라우터
- 라우터는 **인터넷 작업**(네트워크 간의 데이터 전송)을 가능하게 하는 중요한 장치
  - 라우터는 어떤 네트워크에서 다른 네트워크에 데이터그램을 보내는 역할
  - 네트워크와 네트워크의 경계상에 배치됨
    - 복수의 인터페이스를 가질 수 있으며, 인터페이스에는 각각 다른 IP 주소가 설정되어 있음
    - 라우터의 각 인터페이스는 각각의 네트워크에 소속되어 있는 형태
  - 라우팅을 하여 경로를 만드는 역할
    - 라우팅 : 데이터그램의 수신처 IP 주소를 근거로 다음에 송신하는 라우터를 결정하는 것으로, 이를 통해 '경로'가 결정됨
  - 복수의 네트워크끼리 연결하는 역할
    - 라우터는 네트워크 경계선상에 있으므로, 다른 종류의 네트워크를 연결하는 역할 수행
    - 복수의 네트워크는 LAN으로 사용되는 이더넷인 경우도 있고, WAN으로 사용되는 회선인 경우도 있음
  - 필터링에 의해 라우팅하는 데이터를 분류하는 역할
    - **필터링(Filtering)** : 전송받은 데이터그램에 대해 조건을 붙여 그 데이터그램을 파기하는 처리
- 라우터의 동작
  - 라우터는 경로를 선택하기 위해서 라우팅 테이블을 가짐
  - **라우팅 테이블** : 라우터가 수신한 패킷이 수신처까지 도달하기 위한 최적의 경로가 그려져 있는 지도라고 생각 가능
    - 수신처 네트워크까지의 거리, 다음에 도달하는 라우터, 그 라우터에 연결되어 있는 자신의 인터페이스 등이 기재되어 있음
  - 라우팅 테이블에서 다음 수신처가 되는 라우터, 송신할 인터페이스를 결정
    1. 호스트로부터 패킷을 수신받음
    2. 수신처 IP 주소로부터 수신처 네트워크를 결정
    3. 라우팅 테이블에서 다음 중계할 라우터, 송신할 인터페이스 결정
    4. 결정된 인터페이스로부터 패킷 송신
  - 라우팅 테이블에서 '최장일치의 룰'이라는 규칙으로 다음 수신처를 찾아냄
    - **최장일치의 룰(Longest Match)** : 수신처 IP 주소의 비트열과 수신처 네트워크 주소의 비트열을 앞에서부터 순서대로 비교해서, 가장 많이 일치하는 것부터 선택하는 규칙

<br>
<br>

### 4-3. 디폴트 게이트웨이
- 브로드캐스트는 라우터를 넘어서 전송할 수 없음
  - 라우터가 네트워크를 나누기 때문에, 브로드캐스트가 다른 네트워크에 송신되지 않도록 함
- **브로드캐스트 도메인(Broadcast Domain)** : 브로드캐스트가 도달하는 범위
  - 라우터는 브로드캐스트 도메인을 나눌 수 있는 것
  - 충돌 도메인은 스위치가 구분, 브로드캐스트 도메인은 라우터가 구분
    - 충돌 영향이 미치는 범위 - 충돌 도메인
    - 허브는 어느 쪽에도 영향을 미치지 않음
  - 라우터가 브로드캐스트 도메인을 분할하므로, 라우터가 브로드캐스트 도메인의 경계가 되는 것
    - 브로드캐스트 도메인=네트워크라고 생각 가능
- ARP와 라우터
  - 수신처 MAC 주소를 알아내기 위해서 ARP를 사용하는데, 문제는 ARP가 브로드캐스트라는 것
  - 라우터는 브로드캐스트를 중지하기 때문에, 다른 네트워크에 있는 수신처 MAC 주소를 ARP로부터 입수할 수 없음
  - 4개의 주소가 다 준비되지 않으면 데이터 송신 불가능
- **디폴트 게이트웨이(Default Gateway)** : 컴퓨터가 다음에 보낼 라우터, 네트워크의 출입구 느낌
- **컴퓨터는 다른 네트워크가 수신처인 경우, 디폴트 게이트웨이로 ARP를 수행**
  - 컴퓨터가 최초로 데이터를 보내는 수신처 MAC 주소는 디폴트 게이트웨이의 MAC 주소가 되는 것
    1. 다른 네트워크에 데이터를 보내는 경우, 호스트는 디폴트 게이트웨이로 ARP를 수행해서 디폴트 게이트웨이의 MAC 주소를 입수
       - 따라서 디폴트 게이트웨이의 IP 주소를 모르면 안 되기 때문에, 컴퓨터에는 디폴트 게이트웨이의 IP 주소를 미리 설정해 두는 것 (설정 방법은 수동이나 DHCP)
    2. 호스트는 수신처 MAC 주소를 디폴트 게이트웨이로, 수신처 IP 주소를 수신처 호스트로 해서 패킷을 보냄
    3. 수신받은 디폴트 게이트웨이는 라우팅을 하고, 중계 라우터, 송신포트를 결정하여 다음에 수신받을 상대(중계 라우터 또는 수신처)에게 ARP를 수행
    4. ARP에 의해 입수한 MAC 주소를 수신처 MAC 주소로, 자기 자신의 MAC 주소를 송신처 MAC 주소로 갱신하여 송신 (IP 주소는 변경되지 않음)

<br>
<br>

### 4-4. 라우팅
- 라우팅 테이블
  - 수신처 네트워크, 다음 중계 라우터, 메트릭, 송신 인터페이스가 기재되어 있음
  - 라우터는 라우팅 테이블을 참조하여 수신처까지의 경로 결정
  - 라우팅 테이블에 수신처 네트워크가 없을 경우, 수신처 불명으로 데이터그램을 파기함
- 라우터는 수신처 네트워크까지 최적의 경로를 찾기 위해, 다른 네트워크 경로를 모두 알아야 함
  - 알고 있는 경로 중에서 최적의 경로를 선택해서 라우팅 테이블 작성
- 다른 네트워크의 모든 경로를 알 수 있는 방법
  - **정적 라우팅** : 관리자가 수동으로 라우터에 경로를 입력하는 방법
    - 단점) 수동으로 입력한 경로를 사용할 수 없게 되는 경우가 발생 가능, 그 경우 우회로 변경을 관리자가 수동으로 수행해야 함
  - **동적 라우팅** : 라우터가 자동으로 정보를 서로 교환해서 경로를 알아내는 방법
    - 모든 경로 중에서 자동으로 최적의 경로를 선택해서 라우팅 테이블 작성
    - 단점1) 라우터끼리 정보를 교환한다는 것은 데이터를 서로 주고받는 것, 그만큼의 회선 전송을 압박함, 데이터 전송에 사용되는 분량은 감소
      - 특히 저속 회선을 사용하는 경우 주의 필요 
    - 단점2) 서로 교환한 정보를 가지고 최적의 경로를 계산해야 한다는 점
      - 그만큼 라우터의 처리능력이 필요
      - 능력이 낮은 라우터의 경우, 경로 계산 처리에 치우치다 보면 데이터그램의 전송 처리가 늦어지는 일 발생 가능
    - 단점3) 모든 라우터가 동일한 정보를 가져야 한다는 점 (컨버전스여야 함)
      - **컨버전스(Convergence)** : 모든 라우터가 동일한 정보를 가지고 있는 상태
      - 네트워크 내의 모든 라우터가 올바른 정보를 가지지 않으면 수신처에 정확하게 도달하지 않음
    - 단점이 많지만, 그만큼 자동으로 장애를 제거할 수 있다는 것은 중요한 것

<br>
<br>

### 4-5. 라우팅 프로토콜
- 동적 라우팅
  - 어떤 장애가 발생했을 때 우회로를 만드는 등 중복성 유지를 위해 동적 라우팅을 많이 사용
  - 특히 대규모 네트워크에서는 필수라고 생각 가능
    - 중복성(Redundancy) : 여분이나 중복이 있다는 것을 말함. 네트워크에서는 여분을 가지고 있어서 장애 등에 대응할 수 있는 것을 의미
- 라우터는 동적 라우팅을 실현할 라우팅 프로토콜을 사용
- **라우팅 프로토콜(Routing Protocol)** : 근접해 있는 라우터 간의 네트워크 정보를 서로 교환하기 위한 규칙
  - 교환한 정보를 근거로 라우팅 테이블을 변경
- **자율화 시스템(Autonomous System)** : 하나의 관리 단체에 의해 관리되는 네트워크 집합체
  - 일반적으로 앞글자를 가져와서 AS라고 부름 (경로 도메인, 경로제어 도메인이라고도 불림)
  - 라우팅에서 AS는 한개의 범위로써 취급
  - 인터넷에 너무 많은 네트워크가 존재하기 때문에, 같은 조직이 관리하는 복수의 네트워크를 AS로 통합해버리는 것
  - 복수의 네트워크를 통합해서 큰 단위의 라우팅을 수행
    - 수신처의 AS에 전달하는 라우팅을 수행하고, AS내부에서 각 네트워크에 전달하는 라우팅을 수행하는 형태
- 라우팅 프로토콜의 종류
  - 사용하는 장소(두 종류)와 동작 방식(네 종류)에 따라 여러 종류가 있음
  - 프로토콜을 사용하는 장소에 따라
    - **EGP(Exterior Gateway Protocol)** : AS 간 라우팅용
    - **IGP(Interior Gateway Protocol)** : AS 내부 라우팅용
    - EGP와 IGP는 프로토콜 이름이 아니라, 라우팅 프로토콜의 종류를 나타내는 말
  - |종류|라우팅 프로토콜|동작|
    |:-:|-|:-:|
    |EGP|EGP (Exterior Gateway Protocol)|디스턴스벡터|
    ||BGP (Border Gateway Protocol)|경로벡터|
    |IGP|RIP (Routing Information Protocol)|디스턴스벡터|
    ||OSPF (Open Shortest Path First)|링크상태|
    ||IS-IS (IntermediateSystem to IntermediateSystem)|링크상태|
    ||EIGRP (Enhanced Interior Gateway Routing Protocol)|하이브리드|
- 라우팅 프로토콜의 역할
  - 라우터 - 근접해 있는 라우터 간의 네트워크 정보를 서로 교환
  - 라우팅 프로토콜 - 경로 정보 교환을 언제 할지, 어떻게 할지, 누구에게 전송할지, 어떤 정보를 전송할지 결정
    1. 라우터는 자신이 접하고 있는 네트워크를 테이블에 유지관리하고 있음
    2. 라우팅 프로토콜을 사용하여 가지고 있는 네트워크의 정보를 서로 교환
    3. 교환한 정보를 사용하여 라우팅 테이블 갱신 
    - 라우팅 프로토콜이 결정한 방식에 따라 정보를 교환해 컨버전스 상태에 도달하는 것
  - 이렇게 교환한 경로 정보를 기준으로 최적의 경로를 라우팅 테이블에 기재 -> 항상 최적의 경로 사용 가능하게 되는 것

<br>
<br>

### 4-6. RIP
- **메트릭(Metric)** : '최적'의 경로를 판단하는 기준
  - 중계 라우터의 수(홉 수), 회선 속도, 정체 상태, 에러 발생률 등이 판단 기준이 됨
  - 값을 계산해서 최솟값을 가지는 것을 최적의 경로로 결정
- **RIP(Routing Information Protocol)** : 디스턴스벡터형 라우팅 프로토콜
  - **디스턴스벡터** : 거리와 방향 의미
  - **라우팅 업데이트(Routing Update)** : RIP에서 라우터가 다른 라우터와 교환하는 정보 (경로갱신정보)
  - RIP에서는 라우팅 업데이트를 교환하고 모르는 경로 정보를 입수함
    - 30초에 1회 업데이트를 보내서, 라우팅 테이블을 그대로 교환하여 새로운 정보를 추가해 가는 것
    - 업데이트를 6번 수신 받지 않으면, 해당 라우터에는 뭔가 장애가 발생했다고 간주하여 그 라우터를 사용하는 경로들을 파기함
  - RIP의 메트릭은 홉 수(수신처 네트워크까지 통과하는 라우터 수)
    - 개념상 '거리'라고 할 수 있음 
  - RIP는 업데이트를 수신하면, 자신의 것과 비교해서 모르는 네트워크를 테이블에 추가
    - 업데이트를 보내온 라우터를 그 앞의 네트워크에의 중계 라우터로 정함
    - 업데이트를 받은 인터페이스를 그 앞의 네트워크에의 송신 인터페이스로 정함 
    - -> 근접해 있는 라우터가 알고 있는 네트워크 정보를 얻을 수 있음
    - -> 가르쳐준 라우터가 있는 '방향'이 수신처 네트워크의 경로가 되는 것
  - 알고 있는 경로의 정보를 입수한 경우 메트릭으로 판단
    - 이미 테이블에 존재하는 네트워크에 대해서 새로운 정보가 업데이트되면
      - 새로운 경로 쪽이 메트릭이 작으면 그쪽을 테이블에 기재
      - 새로운 경로 쪽의 메트릭이 크면 무시
  - 가르쳐 준 라우터가 있는 '방향', 홉 수라는 '거리' => 거리와 방향으로 디스턴스벡터

<br>
<br>

### Reference
- [하루 3분 네트워크 교실](http://www.yes24.com/Product/Goods/30670329) - 아미노 에이지 저. 영진닷컴. 2016